import te from"./App-b210138e.js";import{r as m,T as se,O as ae,s as I,B as le,o as d,c,a as e,w as R,v as J,u as C,b as B,d as oe,t,f as o,g as n,z as H,k as h,F as j,e as P,i as Y,n as ie,l as ne}from"./app-586cbc19.js";/* empty css              */import{d as re}from"./debounce-f0e5e0a5.js";import"./FormSelect-4a83dbbc.js";import{_ as q}from"./Modal-a35cf5fb.js";import{_ as de}from"./Table-3be4b86e.js";import{T as ue,a as ce,_ as $}from"./TableHeaderRowItem-aa192b53.js";import{T as pe,a as me,_ as k}from"./TableBodyRowItem-405cc657.js";import{_ as he}from"./WhatsappTemplate-74d02d0d.js";import"./Sidebar-c20edeb2.js";import"./Menu-dd50bd69.js";import"./ProfileModal-e2807503.js";import"./FormInput-bee1ab8e.js";import"./FormPhoneInput-c57cb35b.js";import"./hidden-bc07d1fe.js";import"./use-text-value-a2f8b922.js";import"./transition-c0d64afd.js";import"./LangToggle-e8dc491d.js";import"./index-a65940f1.js";import"./MobileSidebar-68e85834.js";import"./_baseGetTag-49d45606.js";import"./Pagination-834739c7.js";import"./_plugin-vue_export-helper-c27b6911.js";const fe={class:"flex items-center justify-between mb-6"},ge={class:"bg-white flex items-center shadow-sm h-10 w-80 rounded-[0.5rem] mb-6 text-sm"},ve=["placeholder"],_e={key:1,class:"pr-2"},be=["disabled"],xe={class:"flex gap-2 mb-4"},we=["value"],ye={key:0,class:"border-b border-dashed border-black"},$e={key:1,class:"border-b border-dashed border-black"},ke=["onClick"],Ce={class:"text-xl text-slate-600"},Te={class:"max-w-md w-full space-y-8"},Se={class:"mt-8 space-y-2"},Me={class:"text-sm border-b pb-2"},Ne={class:"flex items-center capitalize"},Oe={key:0},Re={class:"text-sm mb-3 bg-red-800 p-2 rounded text-white"},Be={key:1},Ve={class:"text-sm mb-3 bg-red-800 p-2 rounded text-white"},ze={key:0,class:"text-sm"},je={key:1},Le={class:"mt-5 grid grid-cols-1 gap-x-6 gap-y-4"},De={class:"mt-2 w-full"},Ee={class:"space-y-4"},Fe={class:"text-lg font-semibold text-slate-700"},Ae={class:"text-sm text-slate-600"},Ue={class:"text-primary"},Ie={class:"text-sm text-slate-600 block mb-1"},Je=["min"],He={class:"text-xs text-slate-500 mt-1"},Pe={class:"flex justify-end gap-3 pt-4"},qe=["disabled"],Ye={__name:"CampaignLogTable",props:{rows:{type:Object,required:!0},filters:{type:Object},uuid:{type:String}},emits:["delete"],setup(T,{emit:r}){const i=T,_=m({search:i.filters.search}),p=m(null),b=m(null),x=m(!1),w=m(!1),g=m(!1),y=se({contact_ids:[],uuid:i.uuid,schedule_at:null,mode:"retry"}),Z=()=>{_.value.search=null,D()},L=re(()=>{w.value=!0,D()},1e3),D=()=>{ae.visit("/campaigns/"+i.uuid,{method:"get",data:_.value})},G=(a,l)=>{b.value=a,p.value=l,x.value=!0},E=a=>JSON.parse(a).status,S=a=>JSON.parse(a),u=m([]),O=m(!1),V=m(!1),F=a=>{const l=i.rows.data.filter(s=>{var v,f;return a==="read"?s.status==="success"&&((v=s.chat)==null?void 0:v.status)==="read":a==="failed"?s.status==="failed"||((f=s.chat)==null?void 0:f.status)==="failed":!1}).map(s=>s.id);u.value=l.every(s=>u.value.includes(s))?[]:l},z=I(()=>i.rows.data.map(a=>a.id)),K=()=>{u.value=O.value?[...z.value]:[]};le(u,()=>{O.value=u.value.length===z.value.length&&z.value.length>0});const Q=()=>{V.value=!0},W=()=>{V.value=!1,rescheduleAt.value=nul},X=()=>{g.value=!0,y.contact_ids=u.value,console.log(y),y.post("/campaigns/reschedule",{onFinish:()=>{g.value=!1}})},ee=I(()=>{const a=new Date;return a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),a.toISOString().slice(0,16)});return(a,l)=>(d(),c(j,null,[e("div",fe,[e("div",ge,[l[11]||(l[11]=e("span",{class:"pl-3"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m15 15l6 6m-11-4a7 7 0 1 1 0-14a7 7 0 0 1 0 14Z"})])],-1)),R(e("input",{onInput:l[0]||(l[0]=(...s)=>C(L)&&C(L)(...s)),"onUpdate:modelValue":l[1]||(l[1]=s=>_.value.search=s),type:"text",class:"outline-none px-4 w-full",placeholder:a.$t("Search campaigns")},null,40,ve),[[J,_.value.search]]),w.value===!1&&_.value.search?(d(),c("button",{key:0,onClick:Z,type:"button",class:"pr-2"},[...l[9]||(l[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10s10-4.5 10-10S17.5 2 12 2zm3.7 12.3c.4.4.4 1 0 1.4c-.4.4-1 .4-1.4 0L12 13.4l-2.3 2.3c-.4.4-1 .4-1.4 0c-.4-.4-.4-1 0-1.4l2.3-2.3l-2.3-2.3c-.4-.4-.4-1 0-1.4c.4-.4 1-.4 1.4 0l2.3 2.3l2.3-2.3c.4-.4 1-.4 1.4 0c.4.4.4 1 0 1.4L13.4 12l2.3 2.3z"})],-1)])])):B("",!0),w.value?(d(),c("span",_e,[...l[10]||(l[10]=[oe('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0"><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12"></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0"></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0"><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12"></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0"></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0"><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12"></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0"></animate></circle></svg>',1)])])):B("",!0)]),e("button",{type:"button",disabled:u.value.length===0,onClick:Q,class:"px-4 py-2 text-sm rounded bg-primary text-white disabled:bg-gray-300 disabled:cursor-not-allowed"},t(a.$t("Retry Campaign"))+" ("+t(u.value.length)+") ",9,be)]),e("div",xe,[e("button",{type:"button",onClick:l[2]||(l[2]=s=>F("failed")),class:"px-3 py-1 text-xs bg-red-600 text-white rounded"},t(a.$t("Failed")),1),e("button",{type:"button",onClick:l[3]||(l[3]=s=>F("read")),class:"px-3 py-1 text-xs bg-green-600 text-white rounded"},t(a.$t("Read")),1),e("button",{type:"button",onClick:l[4]||(l[4]=s=>u.value=[]),class:"px-3 py-1 text-xs bg-gray-300 rounded"},t(a.$t("Clear")),1)]),o(de,{rows:T.rows},{default:n(()=>[o(ue,null,{default:n(()=>[o(ce,null,{default:n(()=>[o($,{position:"first",class:"hidden sm:table-cell"},{default:n(()=>[R(e("input",{type:"checkbox","onUpdate:modelValue":l[5]||(l[5]=s=>O.value=s),onChange:K},null,544),[[H,O.value]])]),_:1}),o($,null,{default:n(()=>[h(t(a.$t("Contact")),1)]),_:1}),o($,null,{default:n(()=>[h(t(a.$t("Phone")),1)]),_:1}),o($,{class:"hidden sm:table-cell"},{default:n(()=>[h(t(a.$t("Last updated")),1)]),_:1}),o($,null,{default:n(()=>[h(t(a.$t("Status")),1)]),_:1}),o($,{position:"last"})]),_:1})]),_:1}),o(pe,null,{default:n(()=>[(d(!0),c(j,null,P(T.rows.data,(s,v)=>(d(),Y(me,{key:v},{default:n(()=>[o(k,{position:"first",class:"hidden sm:table-cell"},{default:n(()=>[R(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":l[6]||(l[6]=f=>u.value=f)},null,8,we),[[H,u.value]])]),_:2},1024),o(k,null,{default:n(()=>[h(t(s.contact.full_name),1)]),_:2},1024),o(k,null,{default:n(()=>[h(t(s.contact.phone),1)]),_:2},1024),o(k,{class:"hidden sm:table-cell"},{default:n(()=>[s.status==="success"?(d(),c("span",ye,t(s.chat.created_at),1)):(d(),c("span",$e,t(s.created_at),1))]),_:2},1024),o(k,null,{default:n(()=>[e("span",{class:ie(["px-2 py-1 text-xs rounded-md capitalize",s.status==="success"&&s.chat.status!=="failed"?"bg-green-700 text-white":"bg-red-400 text-white"])},t(s.status==="success"?s.chat.status:s.status),3)]),_:2},1024),o(k,null,{default:n(()=>[e("div",{onClick:f=>{var M;return G(s.status,s.status==="success"?(M=s.chat)==null?void 0:M.logs:s.metadata)},class:"flex items-center underline cursor-pointer"},[l[12]||(l[12]=e("svg",{class:"mr-1",xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24"},[e("g",{fill:"currentColor"},[e("path",{d:"M11 10.98a1 1 0 1 1 2 0v6a1 1 0 1 1-2 0zm1-4.929a1 1 0 1 0 0 2a1 1 0 0 0 0-2"}),e("path",{"fill-rule":"evenodd",d:"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10s10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 0 16 0a8 8 0 0 0-16 0","clip-rule":"evenodd"})])],-1)),e("span",null,t(a.$t("More info")),1)],8,ke)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["rows"]),o(q,{label:a.modalLabel,isOpen:x.value},{default:n(()=>{var s,v,f,M,A,U;return[e("span",Ce,t(a.$t("Message info")),1),e("div",Te,[e("div",Se,[b.value==="success"?(d(!0),c(j,{key:0},P(p.value,(N,St)=>(d(),c("div",Me,[e("div",Ne,[l[13]||(l[13]=e("svg",{class:"mr-1",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"m1.75 9.75l2.5 2.5m3.5-4l2.5-2.5m-4.5 4l2.5 2.5l6-6.5"})],-1)),e("span",null,t(a.$t(E(N.metadata))),1)]),e("div",null,t(N.created_at),1),E(N.metadata)==="failed"?(d(),c("div",Oe,[e("div",Re,"Error: "+t(S(N.metadata).errors[0].message),1)])):B("",!0)]))),256)):b.value==="failed"?(d(),c("div",Be,[e("div",Ve,"Error: "+t(S(p.value).data.error.message),1),(f=(v=(s=S(p.value).data)==null?void 0:s.error)==null?void 0:v.error_data)!=null&&f.details?(d(),c("div",ze,t((U=(A=(M=S(p.value).data)==null?void 0:M.error)==null?void 0:A.error_data)==null?void 0:U.details),1)):(d(),c("div",je,t(S(p.value).data.error.message),1))])):B("",!0)])]),e("div",Le,[e("div",De,[e("button",{type:"button",onClick:l[7]||(l[7]=N=>x.value=!1),class:"inline-flex float-right justify-center rounded-md border border-transparent bg-slate-50 px-4 py-2 text-sm text-slate-500 hover:bg-slate-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},t(a.$t("Close")),1)])])]}),_:1},8,["label","isOpen"]),o(q,{isOpen:V.value},{default:n(()=>[e("div",Ee,[e("h2",Fe,t(a.$t("Retry / Reschedule Campaign")),1),e("p",Ae,[h(t(a.$t("You have selected"))+" ",1),e("strong",Ue,t(u.value.length),1),h(" "+t(a.$t("contacts")),1)]),e("div",null,[e("label",Ie,t(a.$t("Schedule Date & Time (optional)")),1),R(e("input",{type:"datetime-local","onUpdate:modelValue":l[8]||(l[8]=s=>C(y).schedule_at=s),min:ee.value,class:"w-full border rounded px-3 py-2 text-sm"},null,8,Je),[[J,C(y).schedule_at]]),e("p",He,t(a.$t("Leave empty to retry immediately")),1)]),e("div",Pe,[e("button",{type:"button",onClick:W,class:"px-4 py-2 text-sm rounded bg-gray-100 text-gray-700"},t(a.$t("Cancel")),1),e("button",{onClick:X,disabled:g.value,class:"px-4 py-2 text-sm rounded bg-primary text-white disabled:opacity-50"},t(g.value?"Processing...":C(y).schedule_at?"Reschedule":"Retry Now"),9,qe)])])]),_:1},8,["isOpen"])],64))}},Ze={class:"p-4 md:p-8 rounded-[5px] h-full overflow-y-auto capitalize"},Ge={class:"flex justify-between"},Ke={class:"text-xl mb-1"},Qe={class:"mb-6 flex items-center text-sm leading-6"},We={class:"ml-1 mt-1"},Xe={class:"space-x-2"},et=["href"],tt={class:"md:flex md:space-x-4"},st={class:"md:w-[70%]"},at={class:"flex w-[100%] mb-8 rounded-lg"},lt={class:"w-full rounded-tl-lg rounded-bl-lg text-center bg-white py-8 border"},ot={class:"text-xl"},it={class:"text-sm"},nt={class:"w-full text-center bg-white py-8 border"},rt={class:"text-xl"},dt={class:"text-sm"},ut={class:"w-full text-center bg-white py-8 border"},ct={class:"text-xl"},pt={class:"text-sm"},mt={class:"w-full bg-white text-center py-8 border"},ht={class:"text-xl"},ft={class:"text-sm"},gt={class:"w-full rounded-tr-lg rounded-br-lg bg-white text-center py-8 border"},vt={class:"text-xl"},_t={class:"text-sm"},bt={class:"md:w-[30%]"},xt={class:"w-full rounded-lg bg-white pt-4 pb-8 border px-4 space-y-1"},wt={class:"mb-2"},yt={class:"text-sm bg-slate-100 p-3 rounded-lg"},$t={class:"text-sm bg-slate-100 p-3 rounded-lg"},kt={class:"text-sm bg-slate-100 p-3 rounded-lg"},Ct={class:"text-sm bg-slate-100 p-3 rounded-lg"},Tt={class:"w-full rounded-lg p-5 mt-5 border chat-bg"},Wt={__name:"View",props:["campaign","rows","filters","template"],setup(T){const r=T;return(i,_)=>(d(),Y(te,null,{default:n(()=>{var p,b,x,w,g;return[e("div",Ze,[e("div",Ge,[e("div",null,[e("h2",Ke,t(i.$t("Campaign details")),1),e("p",Qe,[e("span",We,t(i.$t("Ref"))+": "+t(r.campaign.uuid),1)])]),e("div",Xe,[e("a",{href:"/campaigns/export/"+r.campaign.uuid,class:"rounded-md bg-secondary px-3 py-2 text-sm text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},t(i.$t("Export as CSV")),9,et),o(C(ne),{href:"/campaigns",class:"rounded-md bg-primary px-3 py-2 text-sm text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},{default:n(()=>[h(t(i.$t("Back")),1)]),_:1})])]),e("div",tt,[e("div",st,[e("div",at,[e("div",lt,[e("h2",ot,t(r.campaign.total_message_count),1),e("h4",it,t(i.$t("Messages")),1)]),e("div",nt,[e("h2",rt,t(r.campaign.total_sent_count),1),e("h4",dt,t(i.$t("Sent")),1)]),e("div",ut,[e("h2",ct,t(r.campaign.total_delivered_count),1),e("h4",pt,t(i.$t("Delivered")),1)]),e("div",mt,[e("h2",ht,t(r.campaign.total_read_count),1),e("h4",ft,t(i.$t("Read")),1)]),e("div",gt,[e("h2",vt,t(r.campaign.total_failed_count),1),e("h4",_t,t(i.$t("Failed")),1)])]),o(Ye,{rows:r.rows,filters:r.filters,uuid:r.campaign.uuid,template:r.template},null,8,["rows","filters","uuid","template"])]),e("div",bt,[e("div",xt,[e("h2",wt,t(i.$t("Campaign details")),1),e("div",yt,[e("h3",null,t(i.$t("Campaign name")),1),e("p",null,t((p=r.campaign)==null?void 0:p.name),1)]),e("div",$t,[e("h3",null,t(i.$t("Template")),1),e("p",null,t((x=(b=r.campaign)==null?void 0:b.template)==null?void 0:x.name),1)]),e("div",kt,[e("h3",null,t(i.$t("Recipients")),1),e("p",null,t(r.campaign.contact_group_id==="0"?"All Contacts":(g=(w=r.campaign)==null?void 0:w.contact_group)==null?void 0:g.name),1)]),e("div",Ct,[e("h3",null,t(i.$t("Time scheduled")),1),e("p",null,t(r.campaign.scheduled_at),1)])]),e("div",Tt,[o(he,{parameters:JSON.parse(r.campaign.metadata),visible:!0},null,8,["parameters"])])])])])]}),_:1}))}};export{Wt as default};
