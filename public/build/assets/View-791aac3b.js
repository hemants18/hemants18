import G from"./App-dbd17314.js";import{r as f,O as K,q as Q,H as W,o as d,c as u,a as e,w as R,v as X,u as j,b as N,d as ee,t,f as o,g as i,y as J,k as m,F as V,e as U,i as I,n as te,l as se}from"./app-71688fef.js";/* empty css              */import{d as ae}from"./debounce-ca5b1124.js";import{_ as q}from"./Modal-0745b486.js";import{_ as le}from"./Table-ac60e71b.js";import{T as oe,a as ie,_ as w}from"./TableHeaderRowItem-5d388c55.js";import{T as ne,a as re,_ as x}from"./TableBodyRowItem-2ef1b054.js";import{_ as de}from"./WhatsappTemplate-1712220b.js";import"./Sidebar-4facdee5.js";import"./Menu-51e1dddd.js";import"./ProfileModal-a0ead7b3.js";import"./FormInput-20df0373.js";import"./FormSelect-4c8a2141.js";import"./hidden-1e440d84.js";import"./use-text-value-42fe46f0.js";import"./transition-69c2c596.js";import"./index-e82fb76e.js";import"./MobileSidebar-11af113e.js";import"./_baseGetTag-14c244f1.js";import"./Pagination-085ceb4a.js";import"./_plugin-vue_export-helper-c27b6911.js";const ue={class:"flex items-center justify-between mb-6"},ce={class:"bg-white flex items-center shadow-sm h-10 w-80 rounded-[0.5rem] mb-6 text-sm"},pe=["placeholder"],me={key:1,class:"pr-2"},he=["disabled"],fe={class:"flex gap-2 mb-4"},ge=["value"],ve={key:0,class:"border-b border-dashed border-black"},be={key:1,class:"border-b border-dashed border-black"},_e=["onClick"],ye={class:"text-xl text-slate-600"},we={class:"max-w-md w-full space-y-8"},xe={class:"mt-8 space-y-2"},$e={class:"text-sm border-b pb-2"},Ce={class:"flex items-center capitalize"},ke={key:0},Te={class:"text-sm mb-3 bg-red-800 p-2 rounded text-white"},Se={key:1},Me={class:"text-sm mb-3 bg-red-800 p-2 rounded text-white"},Ne={key:0,class:"text-sm"},Be={key:1},Oe={class:"mt-5 grid grid-cols-1 gap-x-6 gap-y-4"},Re={class:"mt-2 w-full"},Ve={class:"space-y-4"},je={class:"text-lg font-semibold text-slate-700"},ze={class:"text-sm text-slate-600"},Le={class:"text-primary"},Ee={class:"flex justify-end gap-3 pt-4"},Ae={__name:"CampaignLogTable",props:{rows:{type:Object,required:!0},filters:{type:Object},uuid:{type:String}},emits:["delete"],setup($,{emit:r}){const n=$,v=f({search:n.filters.search}),p=f(null),b=f(null),_=f(!1),y=f(!1),S=()=>{v.value.search=null,L()},z=ae(()=>{y.value=!0,L()},1e3),L=()=>{K.visit("/campaigns/"+n.uuid,{method:"get",data:v.value})},P=(l,a)=>{b.value=l,p.value=a,_.value=!0},E=l=>JSON.parse(l).status,C=l=>JSON.parse(l),c=f([]),M=f(!1),B=f(!1),A=l=>{const a=n.rows.data.filter(s=>{var g,h;return l==="read"?s.status==="success"&&((g=s.chat)==null?void 0:g.status)==="read":l==="failed"?s.status==="failed"||((h=s.chat)==null?void 0:h.status)==="failed":!1}).map(s=>s.id);c.value=a.every(s=>c.value.includes(s))?[]:a},O=Q(()=>n.rows.data.map(l=>l.id)),Y=()=>{c.value=M.value?[...O.value]:[]};W(c,()=>{M.value=c.value.length===O.value.length&&O.value.length>0});const Z=()=>{B.value=!0},D=()=>{B.value=!1};return(l,a)=>(d(),u(V,null,[e("div",ue,[e("div",ce,[a[11]||(a[11]=e("span",{class:"pl-3"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m15 15l6 6m-11-4a7 7 0 1 1 0-14a7 7 0 0 1 0 14Z"})])],-1)),R(e("input",{onInput:a[0]||(a[0]=(...s)=>j(z)&&j(z)(...s)),"onUpdate:modelValue":a[1]||(a[1]=s=>v.value.search=s),type:"text",class:"outline-none px-4 w-full",placeholder:l.$t("Search campaigns")},null,40,pe),[[X,v.value.search]]),y.value===!1&&v.value.search?(d(),u("button",{key:0,onClick:S,type:"button",class:"pr-2"},[...a[9]||(a[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10s10-4.5 10-10S17.5 2 12 2zm3.7 12.3c.4.4.4 1 0 1.4c-.4.4-1 .4-1.4 0L12 13.4l-2.3 2.3c-.4.4-1 .4-1.4 0c-.4-.4-.4-1 0-1.4l2.3-2.3l-2.3-2.3c-.4-.4-.4-1 0-1.4c.4-.4 1-.4 1.4 0l2.3 2.3l2.3-2.3c.4-.4 1-.4 1.4 0c.4.4.4 1 0 1.4L13.4 12l2.3 2.3z"})],-1)])])):N("",!0),y.value?(d(),u("span",me,[...a[10]||(a[10]=[ee('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0"><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12"></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0"></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0"><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12"></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0"></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0"><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12"></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0"></animate></circle></svg>',1)])])):N("",!0)]),e("button",{type:"button",disabled:c.value.length===0,onClick:Z,class:"px-4 py-2 text-sm rounded bg-primary text-white disabled:bg-gray-300 disabled:cursor-not-allowed"},t(l.$t("Retry Campaign"))+" ("+t(c.value.length)+") ",9,he)]),e("div",fe,[e("button",{type:"button",onClick:a[2]||(a[2]=s=>A("failed")),class:"px-3 py-1 text-xs bg-red-600 text-white rounded"},t(l.$t("Failed")),1),e("button",{type:"button",onClick:a[3]||(a[3]=s=>A("read")),class:"px-3 py-1 text-xs bg-blue-600 text-white rounded"},t(l.$t("Read")),1),e("button",{type:"button",onClick:a[4]||(a[4]=s=>c.value=[]),class:"px-3 py-1 text-xs bg-gray-300 rounded"},t(l.$t("Clear")),1)]),o(le,{rows:$.rows},{default:i(()=>[o(oe,null,{default:i(()=>[o(ie,null,{default:i(()=>[o(w,{position:"first",class:"hidden sm:table-cell"},{default:i(()=>[R(e("input",{type:"checkbox","onUpdate:modelValue":a[5]||(a[5]=s=>M.value=s),onChange:Y},null,544),[[J,M.value]])]),_:1}),o(w,null,{default:i(()=>[m(t(l.$t("Contact")),1)]),_:1}),o(w,null,{default:i(()=>[m(t(l.$t("Phone")),1)]),_:1}),o(w,{class:"hidden sm:table-cell"},{default:i(()=>[m(t(l.$t("Last updated")),1)]),_:1}),o(w,null,{default:i(()=>[m(t(l.$t("Status")),1)]),_:1}),o(w,{position:"last"})]),_:1})]),_:1}),o(ne,null,{default:i(()=>[(d(!0),u(V,null,U($.rows.data,(s,g)=>(d(),I(re,{key:g},{default:i(()=>[o(x,{position:"first",class:"hidden sm:table-cell"},{default:i(()=>[R(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":a[6]||(a[6]=h=>c.value=h)},null,8,ge),[[J,c.value]])]),_:2},1024),o(x,null,{default:i(()=>[m(t(s.contact.full_name),1)]),_:2},1024),o(x,null,{default:i(()=>[m(t(s.contact.phone),1)]),_:2},1024),o(x,{class:"hidden sm:table-cell"},{default:i(()=>[s.status==="success"?(d(),u("span",ve,t(s.chat.created_at),1)):(d(),u("span",be,t(s.created_at),1))]),_:2},1024),o(x,null,{default:i(()=>[e("span",{class:te(["px-2 py-1 text-xs rounded-md capitalize",s.status==="success"&&s.chat.status!=="failed"?"bg-green-700 text-white":"bg-red-400 text-white"])},t(s.status==="success"?s.chat.status:s.status),3)]),_:2},1024),o(x,null,{default:i(()=>[e("div",{onClick:h=>{var k;return P(s.status,s.status==="success"?(k=s.chat)==null?void 0:k.logs:s.metadata)},class:"flex items-center underline cursor-pointer"},[a[12]||(a[12]=e("svg",{class:"mr-1",xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24"},[e("g",{fill:"currentColor"},[e("path",{d:"M11 10.98a1 1 0 1 1 2 0v6a1 1 0 1 1-2 0zm1-4.929a1 1 0 1 0 0 2a1 1 0 0 0 0-2"}),e("path",{"fill-rule":"evenodd",d:"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10s10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 0 16 0a8 8 0 0 0-16 0","clip-rule":"evenodd"})])],-1)),e("span",null,t(l.$t("More info")),1)],8,_e)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["rows"]),o(q,{label:l.modalLabel,isOpen:_.value},{default:i(()=>{var s,g,h,k,F,H;return[e("span",ye,t(l.$t("Message info")),1),e("div",we,[e("div",xe,[b.value==="success"?(d(!0),u(V,{key:0},U(p.value,(T,bt)=>(d(),u("div",$e,[e("div",Ce,[a[13]||(a[13]=e("svg",{class:"mr-1",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"m1.75 9.75l2.5 2.5m3.5-4l2.5-2.5m-4.5 4l2.5 2.5l6-6.5"})],-1)),e("span",null,t(l.$t(E(T.metadata))),1)]),e("div",null,t(T.created_at),1),E(T.metadata)==="failed"?(d(),u("div",ke,[e("div",Te,"Error: "+t(C(T.metadata).errors[0].message),1)])):N("",!0)]))),256)):b.value==="failed"?(d(),u("div",Se,[e("div",Me,"Error: "+t(C(p.value).data.error.message),1),(h=(g=(s=C(p.value).data)==null?void 0:s.error)==null?void 0:g.error_data)!=null&&h.details?(d(),u("div",Ne,t((H=(F=(k=C(p.value).data)==null?void 0:k.error)==null?void 0:F.error_data)==null?void 0:H.details),1)):(d(),u("div",Be,t(C(p.value).data.error.message),1))])):N("",!0)])]),e("div",Oe,[e("div",Re,[e("button",{type:"button",onClick:a[7]||(a[7]=T=>_.value=!1),class:"inline-flex float-right justify-center rounded-md border border-transparent bg-slate-50 px-4 py-2 text-sm text-slate-500 hover:bg-slate-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},t(l.$t("Close")),1)])])]}),_:1},8,["label","isOpen"]),o(q,{isOpen:B.value},{default:i(()=>[e("div",Ve,[e("h2",je,t(l.$t("Retry Campaign")),1),e("p",ze,[m(t(l.$t("Are you sure you want to retry"))+" ",1),e("strong",Le,t(c.value.length),1),m(" "+t(l.$t("selected messages?")),1)]),e("div",Ee,[e("button",{type:"button",onClick:D,class:"px-4 py-2 text-sm rounded bg-gray-100 text-gray-700 hover:bg-gray-200"},t(l.$t("Cancel")),1),e("button",{type:"button",onClick:a[8]||(a[8]=()=>{l.retryCampaign(),D()}),class:"px-4 py-2 text-sm rounded bg-primary text-white hover:bg-primary"},t(l.$t("Yes, Retry")),1)])])]),_:1},8,["isOpen"])],64))}},De={class:"p-4 md:p-8 rounded-[5px] h-full overflow-y-auto capitalize"},Fe={class:"flex justify-between"},He={class:"text-xl mb-1"},Je={class:"mb-6 flex items-center text-sm leading-6"},Ue={class:"ml-1 mt-1"},qe={class:"space-x-2"},Ie=["href"],Pe={class:"md:flex md:space-x-4"},Ye={class:"md:w-[70%]"},Ze={class:"flex w-[100%] mb-8 rounded-lg"},Ge={class:"w-full rounded-tl-lg rounded-bl-lg text-center bg-white py-8 border"},Ke={class:"text-xl"},Qe={class:"text-sm"},We={class:"w-full text-center bg-white py-8 border"},Xe={class:"text-xl"},et={class:"text-sm"},tt={class:"w-full text-center bg-white py-8 border"},st={class:"text-xl"},at={class:"text-sm"},lt={class:"w-full bg-white text-center py-8 border"},ot={class:"text-xl"},it={class:"text-sm"},nt={class:"w-full rounded-tr-lg rounded-br-lg bg-white text-center py-8 border"},rt={class:"text-xl"},dt={class:"text-sm"},ut={class:"md:w-[30%]"},ct={class:"w-full rounded-lg bg-white pt-4 pb-8 border px-4 space-y-1"},pt={class:"mb-2"},mt={class:"text-sm bg-slate-100 p-3 rounded-lg"},ht={class:"text-sm bg-slate-100 p-3 rounded-lg"},ft={class:"text-sm bg-slate-100 p-3 rounded-lg"},gt={class:"text-sm bg-slate-100 p-3 rounded-lg"},vt={class:"w-full rounded-lg p-5 mt-5 border chat-bg"},Ht={__name:"View",props:["campaign","rows","filters"],setup($){const r=$;return(n,v)=>(d(),I(G,null,{default:i(()=>{var p,b,_,y,S;return[e("div",De,[e("div",Fe,[e("div",null,[e("h2",He,t(n.$t("Campaign details")),1),e("p",Je,[e("span",Ue,t(n.$t("Ref"))+": "+t(r.campaign.uuid),1)])]),e("div",qe,[e("a",{href:"/campaigns/export/"+r.campaign.uuid,class:"rounded-md bg-secondary px-3 py-2 text-sm text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},t(n.$t("Export as CSV")),9,Ie),o(j(se),{href:"/campaigns",class:"rounded-md bg-primary px-3 py-2 text-sm text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},{default:i(()=>[m(t(n.$t("Back")),1)]),_:1})])]),e("div",Pe,[e("div",Ye,[e("div",Ze,[e("div",Ge,[e("h2",Ke,t(r.campaign.total_message_count),1),e("h4",Qe,t(n.$t("Messages")),1)]),e("div",We,[e("h2",Xe,t(r.campaign.total_sent_count),1),e("h4",et,t(n.$t("Sent")),1)]),e("div",tt,[e("h2",st,t(r.campaign.total_delivered_count),1),e("h4",at,t(n.$t("Delivered")),1)]),e("div",lt,[e("h2",ot,t(r.campaign.total_read_count),1),e("h4",it,t(n.$t("Read")),1)]),e("div",nt,[e("h2",rt,t(r.campaign.total_failed_count),1),e("h4",dt,t(n.$t("Failed")),1)])]),o(Ae,{rows:r.rows,filters:r.filters,uuid:r.campaign.uuid},null,8,["rows","filters","uuid"])]),e("div",ut,[e("div",ct,[e("h2",pt,t(n.$t("Campaign details")),1),e("div",mt,[e("h3",null,t(n.$t("Campaign name")),1),e("p",null,t((p=r.campaign)==null?void 0:p.name),1)]),e("div",ht,[e("h3",null,t(n.$t("Template")),1),e("p",null,t((_=(b=r.campaign)==null?void 0:b.template)==null?void 0:_.name),1)]),e("div",ft,[e("h3",null,t(n.$t("Recipients")),1),e("p",null,t(r.campaign.contact_group_id==="0"?"All Contacts":(S=(y=r.campaign)==null?void 0:y.contact_group)==null?void 0:S.name),1)]),e("div",gt,[e("h3",null,t(n.$t("Time scheduled")),1),e("p",null,t(r.campaign.scheduled_at),1)])]),e("div",vt,[o(de,{parameters:JSON.parse(r.campaign.metadata),visible:!0},null,8,["parameters"])])])])])]}),_:1}))}};export{Ht as default};
